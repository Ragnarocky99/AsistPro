<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista de Asistencias</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 1rem 0;
        }
        .header h1 {
            margin: 0;
        }
        .table-container {
            margin-top: 2rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .table thead th {
            background-color: #e9ecef;
            color: #495057;
            font-weight: 500;
        }
        .table tbody tr:hover {
            background-color: #f1f3f5;
        }
        .rasgo-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 0.5rem;
        }
        .rasgo-item {
            padding: 0.25rem 0.5rem;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }
        .select2-container--default .select2-selection--multiple {
            height: auto;
            min-height: 34px;
            font-size: 0.75rem;
            border-radius: 0.25rem;
            border: 1px solid #ced4da;
        }
        .btn-custom {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            height: auto;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <header th:replace="plantilla/plantilla :: encabezado" class="header">
        <h1>Lista de Asistencias</h1>
    </header>
    <main class="container my-4">
        <div class="text-center">
            <h2 th:text="${detalleCabecera.asistencia.horario.materia.nombre}"></h2>
            <h3 th:text="'Profesor: ' + ${detalleCabecera.asistencia.horario.profesor.nombre} + ' ' + ${detalleCabecera.asistencia.horario.profesor.apellido}"></h3>
            <h4 th:text="'Hora inicio: ' + ${detalleCabecera.asistencia.horario.hora_inicio} + ' - Hora fin: ' + ${detalleCabecera.asistencia.horario.hora_fin}"></h4>
        </div>
        <div id="table-container" th:if="${detalles != null and !detalles.empty}" class="table-container">
            <table class="table table-striped table-hover table-sm mb-0">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>CDI</th>
                        <th>Hora de la presencia</th>
                        <th>Curso</th>
                        <th>Sección</th>
                        <th>Especialidad</th>
                        <th>Rasgos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="d : ${detalles}">
                        <td th:text="${d.alumno.nombre}">Muestra nombre</td>
                        <td th:text="${d.alumno.apellido}">Muestra apellido</td>
                        <td th:text="${d.alumno.cdi}">Muestra CDI</td>
                        <td th:text="${d.hora_presencia}">Muestra hora</td>
                        <td th:text="${d.alumno.curso}">Muestra curso</td>
                        <td th:text="${d.alumno.seccion}">Muestra sección</td>
                        <td th:text="${d.alumno.especialidad.nombre}">Muestra especialidad</td>
                        <td>
                            <form th:action="@{/detalle-asistencias/asignarRasgos}" method="POST" class="rasgos-form">
                                <input type="hidden" name="idAsistencia" th:value="${d.asistencia.id_asistencia}">
                                <input type="hidden" name="idAlumno" th:value="${d.alumno.id_alumno}">
                                <div class="d-flex align-items-center">
                                    <select name="rasgos" aria-label="Selecciona rasgos" multiple="multiple" class="form-select select2">
                                        <option value="A5" th:selected="${d.rasgos != null and d.rasgos.contains('A5')}">Responsable</option>
                                        <option value="N8" th:selected="${d.rasgos != null and d.rasgos.contains('N8')}">No trajo el uniforme correcto</option>
                                        <option value="10" th:selected="${d.rasgos != null and d.rasgos.contains('10')}">Palaprotas</option>
                                    </select>
                                    <button type="submit" class="btn btn-primary ms-2 btn-custom">Guardar</button>
                                </div>
                            </form>
                            <div class="rasgo-container mt-2" th:if="${d.rasgos != null}">
                                <div th:each="rasgo : ${d.rasgos.split(',')}" class="rasgo-item">
                                    <span th:text="${rasgo.trim()}"></span>
                                </div>
                            </div>
                            <div class="text-muted" th:if="${d.rasgos == null}">No hay rasgos asignados</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div th:if="${detalles == null or detalles.empty}" class="text-center mt-4">
            <p class="text-muted">La lista no contiene datos.</p>
        </div>
    </main>
    <footer th:replace="plantilla/plantilla :: piedepagina" class="text-center py-3 bg-light border-top"></footer>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script>
    $(document).ready(function() {
        function initializeSelect2() {
            $('.select2').each(function() {
                if (!$(this).data('select2')) {
                    $(this).select2({
                        placeholder: 'Selecciona rasgos',
                        width: '100%'
                    });
                }
            });
        }

        initializeSelect2();

        // Se podría mejorar el manejo de eventos dinámicos aquí si es necesario
    });
    </script>
</body>
</html>
